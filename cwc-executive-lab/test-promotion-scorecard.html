<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Promotion Readiness Scorecard - Regression Tests</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a1a;
            color: #fff;
            padding: 40px;
            line-height: 1.6;
        }
        .container { max-width: 800px; margin: 0 auto; }
        h1 { margin-bottom: 8px; }
        .subtitle { color: #999; margin-bottom: 32px; }
        .test-section {
            background: #2a2a2a;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
        }
        .test-section h2 {
            font-size: 18px;
            margin-bottom: 16px;
            color: #D4A574;
        }
        .test-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid #333;
        }
        .test-item:last-child { border-bottom: none; }
        .status {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            flex-shrink: 0;
        }
        .status.pass { background: #4A9B7F; }
        .status.fail { background: #C45C5C; }
        .status.pending { background: #666; }
        .test-name { flex: 1; }
        .test-detail { font-size: 13px; color: #999; }
        .summary {
            background: linear-gradient(135deg, #2A7B8C 0%, #1a5a66 100%);
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            margin-bottom: 24px;
        }
        .summary-score {
            font-size: 48px;
            font-weight: 700;
        }
        .summary-label { color: rgba(255,255,255,0.7); }
        .btn {
            background: #D4A574;
            color: #fff;
            border: none;
            padding: 14px 28px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 16px;
        }
        .btn:hover { background: #c49660; }
        .btn:disabled { background: #666; cursor: not-allowed; }
        .config-display {
            background: #333;
            border-radius: 8px;
            padding: 16px;
            font-family: monospace;
            font-size: 13px;
            margin-top: 16px;
            overflow-x: auto;
        }
        .config-item { margin: 4px 0; }
        .config-key { color: #D4A574; }
        .config-value { color: #4A9B7F; }
        #test-frame { display: none; }
        .loading { opacity: 0.5; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Promotion Readiness Scorecard</h1>
        <p class="subtitle">Regression Test Suite</p>

        <div class="summary">
            <div class="summary-label">Test Results</div>
            <div class="summary-score" id="test-score">--</div>
            <button class="btn" id="run-btn" onclick="runAllTests()">Run All Tests</button>
        </div>

        <div class="test-section">
            <h2>Configuration Tests</h2>
            <div id="config-tests"><div class="test-item"><div class="status pending">?</div><div class="test-name">Waiting to run...</div></div></div>
        </div>

        <div class="test-section">
            <h2>Scoring Logic Tests</h2>
            <div id="scoring-tests"><div class="test-item"><div class="status pending">?</div><div class="test-name">Waiting to run...</div></div></div>
        </div>

        <div class="test-section">
            <h2>UI Element Tests</h2>
            <div id="ui-tests"><div class="test-item"><div class="status pending">?</div><div class="test-name">Waiting to run...</div></div></div>
        </div>

        <div class="test-section">
            <h2>Link Validation Tests</h2>
            <div id="link-tests"><div class="test-item"><div class="status pending">?</div><div class="test-name">Waiting to run...</div></div></div>
        </div>

        <div class="test-section">
            <h2>Current Configuration</h2>
            <div class="config-display" id="config-display">Click "Run All Tests" to load configuration</div>
        </div>
    </div>

    <!-- Hidden iframe to load the scorecard -->
    <iframe id="test-frame" src="promotion-readiness-scorecard.html"></iframe>

    <script>
        // Test results storage
        let testResults = { passed: 0, failed: 0, tests: [] };

        // Expected configuration
        const expectedConfig = {
            emailjs_public_key: 'y6UfKicpoRY2LvZNa',
            emailjs_service_id: 'service_n62dsgh',
            emailjs_template_id: 'template_xl8go0s',
            recipient_email: 'wendy@coachingwomenofcolor.com',
            calendly_url: 'https://calendly.com/coachingwomenofcolor/executive-leadership-lab-connection-call',
            skool_url: 'https://www.skool.com/cwc-executive-leadership-lab/about',
            total_questions: 10,
            max_score: 50,
            dimensions: 5
        };

        function getLevel(score) {
            if (score >= 45) return "Promotion Ready";
            if (score >= 35) return "Almost There";
            if (score >= 25) return "Building Momentum";
            return "Foundation Stage";
        }

        function addTest(category, name, passed, detail = '') {
            testResults.tests.push({ category, name, passed, detail });
            if (passed) testResults.passed++;
            else testResults.failed++;
        }

        function renderTest(test) {
            return `
                <div class="test-item">
                    <div class="status ${test.passed ? 'pass' : 'fail'}">${test.passed ? '✓' : '✗'}</div>
                    <div>
                        <div class="test-name">${test.name}</div>
                        ${test.detail ? `<div class="test-detail">${test.detail}</div>` : ''}
                    </div>
                </div>
            `;
        }

        function runConfigTests(html) {
            // Test EmailJS public key
            const hasPublicKey = html.includes(expectedConfig.emailjs_public_key);
            addTest('config', 'EmailJS Public Key', hasPublicKey,
                hasPublicKey ? 'Key found in code' : 'Key NOT found - emails will fail');

            // Test Service ID
            const hasServiceId = html.includes(expectedConfig.emailjs_service_id);
            addTest('config', 'EmailJS Service ID', hasServiceId,
                hasServiceId ? `Using ${expectedConfig.emailjs_service_id}` : 'Service ID NOT found');

            // Test Template ID
            const hasTemplateId = html.includes(expectedConfig.emailjs_template_id);
            addTest('config', 'EmailJS Template ID', hasTemplateId,
                hasTemplateId ? `Using ${expectedConfig.emailjs_template_id}` : 'Template ID NOT found');

            // Test recipient email
            const hasRecipient = html.includes(expectedConfig.recipient_email);
            addTest('config', 'Recipient Email', hasRecipient,
                hasRecipient ? expectedConfig.recipient_email : 'Recipient NOT found');

            // Test Calendly URL
            const hasCalendly = html.includes(expectedConfig.calendly_url);
            addTest('config', 'Calendly Link', hasCalendly,
                hasCalendly ? 'Calendly URL present' : 'Calendly URL NOT found');

            // Test Skool URL
            const hasSkool = html.includes(expectedConfig.skool_url);
            addTest('config', 'Skool Link', hasSkool,
                hasSkool ? 'Skool URL present' : 'Skool URL NOT found');

            // Test question count
            const questionMatches = html.match(/category:\s*"/g);
            const questionCount = questionMatches ? questionMatches.length : 0;
            addTest('config', 'Question Count', questionCount === expectedConfig.total_questions,
                `Found ${questionCount} questions (expected ${expectedConfig.total_questions})`);
        }

        function runScoringTests() {
            // Test minimum score
            const minScore = 10;
            const minLevel = getLevel(minScore);
            addTest('scoring', 'Minimum Score Level', minLevel === 'Foundation Stage',
                `Score 10 = "${minLevel}"`);

            // Test maximum score
            const maxScore = 50;
            const maxLevel = getLevel(maxScore);
            addTest('scoring', 'Maximum Score Level', maxLevel === 'Promotion Ready',
                `Score 50 = "${maxLevel}"`);

            // Test boundary: 24 (should be Foundation Stage)
            const level24 = getLevel(24);
            addTest('scoring', 'Score 24 Level', level24 === 'Foundation Stage',
                `Score 24 = "${level24}"`);

            // Test boundary: 25
            const level25 = getLevel(25);
            addTest('scoring', 'Boundary Score 25', level25 === 'Building Momentum',
                `Score 25 = "${level25}"`);

            // Test boundary: 34 (should be Building Momentum)
            const level34 = getLevel(34);
            addTest('scoring', 'Score 34 Level', level34 === 'Building Momentum',
                `Score 34 = "${level34}"`);

            // Test boundary: 35
            const level35 = getLevel(35);
            addTest('scoring', 'Boundary Score 35', level35 === 'Almost There',
                `Score 35 = "${level35}"`);

            // Test boundary: 44 (should be Almost There)
            const level44 = getLevel(44);
            addTest('scoring', 'Score 44 Level', level44 === 'Almost There',
                `Score 44 = "${level44}"`);

            // Test boundary: 45
            const level45 = getLevel(45);
            addTest('scoring', 'Boundary Score 45', level45 === 'Promotion Ready',
                `Score 45 = "${level45}"`);
        }

        function runUITests(html) {
            // Test logo presence
            const hasLogo = html.includes('CWCFinal_logo');
            addTest('ui', 'CWC Logo', hasLogo, hasLogo ? 'Logo image found' : 'Logo NOT found');

            // Test logo format (should be PNG for email compatibility)
            const hasPngLogo = html.includes('.png') && html.includes('CWCFinal_logo');
            addTest('ui', 'Logo PNG Format', hasPngLogo, hasPngLogo ? 'Using PNG format' : 'Not using PNG - may not render in emails');

            // Test progress bar
            const hasProgress = html.includes('progress-fill') && html.includes('progress-bar');
            addTest('ui', 'Progress Bar', hasProgress, hasProgress ? 'Progress elements found' : 'Progress bar NOT found');

            // Test email capture form
            const hasEmailForm = html.includes('user-email') && html.includes('user-name');
            addTest('ui', 'Email Capture Form', hasEmailForm, hasEmailForm ? 'Form fields found' : 'Form NOT found');

            // Test results container
            const hasResults = html.includes('results-container') && html.includes('total-score');
            addTest('ui', 'Results Display', hasResults, hasResults ? 'Results elements found' : 'Results NOT found');

            // Test CTA buttons
            const hasCalendlyCTA = html.includes('Book a Free Connection Call');
            const hasSkoolCTA = html.includes('Learn More About');
            addTest('ui', 'Calendly CTA Button', hasCalendlyCTA, hasCalendlyCTA ? 'Calendly CTA present' : 'Calendly CTA NOT found');
            addTest('ui', 'Skool CTA Button', hasSkoolCTA, hasSkoolCTA ? 'Skool CTA present' : 'Skool CTA NOT found');

            // Test dimensions display
            const hasDimensions = html.includes('dimensions-breakdown');
            addTest('ui', 'Dimensions Breakdown', hasDimensions, hasDimensions ? 'Dimension display found' : 'Dimensions NOT found');

            // Test EmailJS SDK
            const hasEmailJS = html.includes('emailjs.init') && html.includes('@emailjs/browser');
            addTest('ui', 'EmailJS SDK Loaded', hasEmailJS, hasEmailJS ? 'EmailJS SDK present' : 'EmailJS SDK NOT found');
        }

        function runLinkTests(html) {
            // Calendly URL
            const hasCalendly = html.includes(expectedConfig.calendly_url);
            addTest('link', 'Calendly URL', hasCalendly, hasCalendly ? 'URL present in code' : 'URL NOT found');

            // Skool URL
            const hasSkool = html.includes(expectedConfig.skool_url);
            addTest('link', 'Skool URL', hasSkool, hasSkool ? 'URL present in code' : 'URL NOT found');

            // CWC Website
            const hasCWC = html.includes('coachingwomenofcolor.com');
            addTest('link', 'CWC Website URL', hasCWC, hasCWC ? 'URL present in code' : 'URL NOT found');

            // Check for broken subject line encoding
            const hasSlashInSubject = html.includes("Score: ${resultsData.totalScore}/50");
            const hasFixedSubject = html.includes("out of 50");
            addTest('link', 'Subject Line Format', hasFixedSubject && !hasSlashInSubject,
                hasFixedSubject ? 'Using "out of 50" format (no encoding issues)' : 'May have slash encoding issue');
        }

        function renderResults() {
            const total = testResults.passed + testResults.failed;
            document.getElementById('test-score').textContent = `${testResults.passed}/${total}`;

            const categories = {
                'config': 'config-tests',
                'scoring': 'scoring-tests',
                'ui': 'ui-tests',
                'link': 'link-tests'
            };

            for (const [cat, elementId] of Object.entries(categories)) {
                const tests = testResults.tests.filter(t => t.category === cat);
                if (tests.length > 0) {
                    document.getElementById(elementId).innerHTML = tests.map(renderTest).join('');
                }
            }

            document.getElementById('config-display').innerHTML = Object.entries(expectedConfig)
                .map(([key, value]) => `<div class="config-item"><span class="config-key">${key}:</span> <span class="config-value">${value}</span></div>`)
                .join('');
        }

        function runAllTests() {
            const btn = document.getElementById('run-btn');
            btn.disabled = true;
            btn.textContent = 'Running...';

            // Reset
            testResults = { passed: 0, failed: 0, tests: [] };

            // Get the iframe content
            const iframe = document.getElementById('test-frame');

            try {
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                const html = iframeDoc.documentElement.outerHTML;

                if (html && html.length > 100) {
                    runConfigTests(html);
                    runScoringTests();
                    runUITests(html);
                    runLinkTests(html);
                    renderResults();
                } else {
                    document.getElementById('test-score').textContent = 'Error';
                    document.getElementById('config-tests').innerHTML = '<div class="test-item"><div class="status fail">✗</div><div class="test-name">Could not load scorecard file</div></div>';
                }
            } catch (error) {
                document.getElementById('test-score').textContent = 'Error';
                document.getElementById('config-tests').innerHTML = `<div class="test-item"><div class="status fail">✗</div><div><div class="test-name">Error loading tests</div><div class="test-detail">${error.message}</div></div></div>`;
            }

            btn.disabled = false;
            btn.textContent = 'Run All Tests';
        }

        // Wait for iframe to load, then run tests
        document.getElementById('test-frame').addEventListener('load', function() {
            setTimeout(runAllTests, 500);
        });
    </script>
</body>
</html>
